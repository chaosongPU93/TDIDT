%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% Assume now you have raw data (n, e, z, etc), AND templates
% AND catalogs, this script tries to make a finer detection from scratch
% WITH split correction (rotate->shift->rotate back) AND polarization
% rotation (rotate->optimal & orthogonal).
%
% Detections are based on data of optimal direction.
%
%
% By Chao Song, chaosong@princeton.edu
% Last modified date:   2019/02/28
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%